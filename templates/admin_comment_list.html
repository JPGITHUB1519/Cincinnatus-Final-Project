{% extends "administration_base.html" %}
{% block title %}Comment List{% endblock %}

{% block content %}
	<input type="hidden" name="" value="{{ p.key().id() }}" id="post_id">
	<div class="content box">
		<h2 class="text-center little-padding">Comments List</h2>
		<div class="row" id="blog-header">
			<div class="col-md-1 date text-center visible-only-large">
				<p>{{ p.date }}</p>
			</div>
			<div class="col-md-10">
				<h1 class="text-beatiful-red font-lobster">{{ p.subject }}</h1>
			</div>
		</div>

		<div class="row" id="blog-data">
			<div class="col-sm-6">
				<p class="font-pacifico text-semi-large text-center-only-small" >Written By {{ p.user.username}}</p>
			</div>
			<div class="col-sm-6">
				<p class="text-semi-large text-beatiful-blue text-center-only-small">Category : <span class="text-black">{{ p.category.name }}</span></p>
			</div>	
		</div>

		<div class="row" id="blog-content">
			<div class="col-md-12">
				<p>{{ p.content }}</p>
			</div>
		</div>
		<div class="table-responsive">
			<table class="table">
				<thead>
					<tr>
						<td>Subject</td>
						<td>Comment</td>
						<td>User</td>
						<td>Date</td>
						<td>Edit</td>
						<td>Delete</td>
					</tr>
				</thead>
				<tbody>
					{% for data in list_comments %}
						<tr id="row_{{ data.key().id() }}">
							<td>{{ data.subject }}</td>
							<td>{{ data.content }}</td>
							<td>{{ data.user.username }}</td>
							<td>{{ data.date }}</td>
							<td><a href="">Edit</a></td>
							<td><a href="javascript:delete_comment('{{data.key().id()}}');">Delete</a></td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>

		<!-- Edit Comment Modal -->
			<div id="update_category_modal" class="modal fade" role="dialog">
				<div class="modal-dialog">
					<!-- Modal Content -->
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal">&times;</button>
							<h4 class="modal-title">Edit Comment<span id="old_category_name" class="text-info">Category Name</span></h4>
						</div>
						<div class="modal-body">
							<form>
								<div class="centered-form">
									<label class="control-label">Subject</label>
									<input class="form-control" type="text" id="new_category_name" name = "new_category_name" data-category-key="">
									<input class="btn btn-default center-block-only-small center-block little-margin-top" type="submit" value="Submit" id="update_button">
								</div>
								<h3 id="update_error" class="error-text text-center"></h3>
							</form>
						</div>
						<div class="modal-footer">
							<button id="close_updater_modal" type="button" class="btn btn-default" data-dismiss="modal">Close</button>
						</div>
					</div>
				</div>
			</div>
	</div>
	
	<script type="text/javascript">
		function delete_comment(comment_id)
		{
			var post_id = $("#post_id").val();
			$.ajax(
			{
				type : "POST",
				url : "/administration/comment_list/" + post_id,
				contentType: 'application/json',
				datatype : "json",
				// sent json to the server
				data : JSON.stringify({"comment_id" : comment_id, action  : "delete_comment"}),
			})
			.done(function(data)
			{
				console.log(data);
				var status = data["status"];
				var comment_row_id = "#row_" + comment_id;
				console.log(comment_row_id)
				$(comment_row_id).remove();
				
				console.log("Exito");
				
			})
			.fail(function(textStatus)
			{
				console.log(textStatus);
			});
		}
	</script>
{% endblock %}